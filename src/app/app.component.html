<div class="container">
  <header>
    <h1>{{ title }}</h1>
    <p class="subtitle">Distribution automatique et √©quilibr√©e des joueurs en 4 √©quipes</p>
  </header>

  <!-- Zone de drag and drop -->
  <div class="upload-zone"
       [class.drag-over]="isDragOver"
       (dragover)="onDragOver($event)"
       (dragleave)="onDragLeave($event)"
       (drop)="onDrop($event)">
    <div class="upload-content">
      <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
      <h3>Glissez-d√©posez votre fichier CSV/TSV ici</h3>
      <p>ou</p>
      <label class="file-input-label">
        <input type="file" 
               accept=".csv,.tsv" 
               (change)="onFileSelected($event)"
               class="file-input">
        Parcourir les fichiers
      </label>
      <p class="file-info">Format support√© : CSV ou TSV avec colonnes Nom, Pr√©nom, Motivation, Disponibilit√©</p>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div class="error-message" *ngIf="errorMessage">
    ‚ö†Ô∏è {{ errorMessage }}
  </div>

  <!-- Bouton pour afficher/cacher l'explication -->
  <div class="explanation-toggle" *ngIf="teams.length > 0">
    <button (click)="toggleExplanation()" class="toggle-btn">
      {{ showExplanation ? '‚ñº' : '‚ñ∂' }} Explication du dispatch
    </button>
    <div class="explanation-content" *ngIf="showExplanation">
      <pre>{{ explanation }}</pre>
    </div>
  </div>

  <!-- Affichage des √©quipes -->
  <div class="teams-container" *ngIf="teams.length > 0">
    <div class="team-card" 
         *ngFor="let team of teams; let teamIndex = index" 
         [style]="getTeamColorStyle(team.color)"
         [class.drag-over-team]="dragOverTeamIndex === teamIndex"
         (dragover)="onTeamDragOver($event, teamIndex)"
         (dragleave)="onTeamDragLeave($event, teamIndex)"
         (drop)="onTeamDrop($event, teamIndex)">
      <div class="team-header" [style.background-color]="team.color">
        <h2 [style.color]="team.name === 'Blanc' ? '#000' : '#fff'">
          {{ team.name }}
        </h2>
        <span class="team-count" [style.color]="team.name === 'Blanc' ? '#000' : '#fff'">
          {{ team.players.length }} joueur(s)
        </span>
      </div>
      
      <div class="team-stats">
        <div class="stat">
          <span class="stat-label">Score total:</span>
          <span class="stat-value">{{ team.totalScore.toFixed(1) }}</span>
        </div>
        <div class="stat">
          <span class="stat-label">Motivation moy:</span>
          <span class="stat-value">{{ team.avgMotivation.toFixed(2) }}/4</span>
        </div>
        <div class="stat">
          <span class="stat-label">Disponibilit√© moy:</span>
          <span class="stat-value">{{ team.avgDisponibilite.toFixed(2) }}/4</span>
        </div>
      </div>

      <div class="players-list">
        <div class="player-item" 
             *ngFor="let player of team.players"
             draggable="true"
             (dragstart)="onPlayerDragStart($event, player, teamIndex)"
             (dragend)="onPlayerDragEnd($event)"
             [class.dragging]="draggedPlayer === player">
          <div class="player-name">
            <span class="drag-handle">‚ãÆ‚ãÆ</span>
            <strong>{{ player.prenom }} {{ player.nom }}</strong>
          </div>
          <div class="player-details">
            <span class="detail-item" [title]="getMotivationLabel(player.motivation)">
              {{ getMotivationLabel(player.motivation) }}
            </span>
            <span class="detail-item" [title]="getDisponibiliteLabel(player.disponibilite)">
              {{ getDisponibiliteLabel(player.disponibilite) }}
            </span>
          </div>
          <div class="player-score">
            Score: {{ player.score }}
          </div>
          <div class="player-comment" *ngIf="player.commentaire">
            üí¨ {{ player.commentaire }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message initial -->
  <div class="initial-message" *ngIf="teams.length === 0 && !errorMessage">
    <p>üëã Bienvenue ! Uploadez votre fichier pour commencer la distribution des √©quipes.</p>
  </div>
</div>

<!-- Modal de suggestions d'√©change -->
<div class="swap-modal-overlay" *ngIf="showSwapSuggestions" (click)="cancelSwap()">
  <div class="swap-modal" (click)="$event.stopPropagation()">
    <div class="swap-modal-header">
      <h3>üîÑ √âchanger {{ draggedPlayer?.prenom }} {{ draggedPlayer?.nom }}</h3>
      <button class="close-btn" (click)="cancelSwap()">‚úï</button>
    </div>
    
    <div class="swap-modal-content">
      <p class="swap-info">
        Choisissez un joueur √† √©changer ou d√©placez sans √©change :
      </p>

      <button class="swap-option move-without-swap" (click)="movePlayerWithoutSwap(dragOverTeamIndex)">
        <span class="option-icon">‚ûú</span>
        <div class="option-details">
          <strong>D√©placer sans √©change</strong>
          <span class="option-description">
            D√©placer uniquement {{ draggedPlayer?.prenom }} vers l'√©quipe {{ teams[dragOverTeamIndex]?.name }}
          </span>
        </div>
      </button>

      <div class="swap-divider">ou √©changer avec :</div>

      <div class="swap-suggestions">
        <button class="swap-option" 
                *ngFor="let suggestion of swapSuggestions"
                (click)="swapPlayers(suggestion.player)">
          <span class="option-icon">üîÑ</span>
          <div class="option-details">
            <strong>{{ suggestion.player.prenom }} {{ suggestion.player.nom }}</strong>
            <div class="option-stats">
              <span>Score: {{ suggestion.player.score }}</span>
              <span class="motivation-badge">{{ getMotivationLabel(suggestion.player.motivation) }}</span>
              <span class="dispo-badge">{{ getDisponibiliteLabel(suggestion.player.disponibilite) }}</span>
            </div>
            <div class="balance-indicator" [class.good-balance]="suggestion.scoreDifference < 2">
              Diff√©rence de score : {{ suggestion.scoreDifference.toFixed(1) }}
              <span class="balance-label" *ngIf="suggestion.scoreDifference < 2">‚úÖ Bon √©quilibre</span>
              <span class="balance-label warning" *ngIf="suggestion.scoreDifference >= 2 && suggestion.scoreDifference < 4">‚ö†Ô∏è √âquilibre moyen</span>
              <span class="balance-label bad" *ngIf="suggestion.scoreDifference >= 4">‚ùå D√©s√©quilibre</span>
            </div>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>
